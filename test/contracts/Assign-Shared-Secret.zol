// SPDX-License-Identifier: CC0

pragma solidity ^0.8.0;

contract Swap {

    secret mapping(address => uint256) public balances;
    secret mapping(address => mapping(uint256 => address)) public tokenOwners;
    struct swapStruct{
        uint256 swapAmountSent;
        uint256 swapTokenSent;
        uint256 swapAmountRecieved;
        uint256 swapTokenRecieved;
    }
    sharedSecret uint256 pendingStatus;

    sharedSecret mapping(address => swapStruct) swapProposals;  


    function deposit(secret uint256 amount, secret uint256 tokenId) public {
        balances[msg.sender] += amount;
    }

    function deposit_token(secret address contractAddress, secret uint256 tokenId ) public {
        reinitialisable tokenOwners[contractAddress][tokenId] = msg.sender;
    }


    function startSwap(secret address contractAddress, secret address sharedAddress,  secret uint256 amountSent, secret uint256 tokenIdSent, secret uint256 amountRecieved, secret uint256 tokenIdRecieved) public {

           require(pendingStatus == 0);
            swapProposals[sharedAddress].swapAmountSent += amountSent;
            balances[msg.sender] -= amountSent; 
            tokenOwners[contractAddress][tokenIdSent] = sharedAddress;
            swapProposals[sharedAddress].swapTokenSent = tokenIdSent;
            swapProposals[sharedAddress].swapAmountRecieved += amountRecieved;
            swapProposals[sharedAddress].swapTokenRecieved = tokenIdRecieved;
            pendingStatus = 1;

    }

    function completeSwap(secret address contractAddress, secret address counterParty, secret address sharedAddress,  secret uint256 amountSent, secret uint256 tokenIdSent, secret uint256 amountRecieved, secret uint256 tokenIdRecieved) public {

           require(swapProposals[sharedAddress].swapAmountRecieved == amountSent && swapProposals[sharedAddress].swapTokenRecieved == tokenIdSent);
           require(pendingStatus == 1);
            swapProposals[sharedAddress].swapAmountSent -= amountRecieved;
            balances[msg.sender] += amountRecieved; 
            swapProposals[sharedAddress].swapAmountRecieved -= amountSent;
            balances[msg.sender] -= amountSent; 
            unknown balances[counterParty] += amountSent; 

            tokenOwners[contractAddress][tokenIdSent] = counterParty;

            tokenOwners[contractAddress][tokenIdRecieved] = msg.sender;
            pendingStatus = 0;

    }

    function quitSwap(secret address contractAddress, secret address sharedAddress,  secret uint256 amountSent, secret uint256 tokenIdSent) public {

           require(swapProposals[sharedAddress].swapAmountSent == amountSent && swapProposals[sharedAddress].swapTokenSent == tokenIdSent);
           require(pendingStatus == 1);
            swapProposals[sharedAddress].swapAmountSent -= amountSent;
            balances[msg.sender] += amountSent; 
            tokenOwners[contractAddress][tokenIdSent] = msg.sender;
            swapProposals[sharedAddress].swapTokenSent = 0;
            swapProposals[sharedAddress].swapTokenRecieved = 0;
            swapProposals[sharedAddress].swapAmountRecieved = 0;
            pendingStatus = 0;

    }
}